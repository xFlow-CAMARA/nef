# UE Identity Service

The UE Identity Service is a middleware component of the Open-Exposure NEF stack. It is responsible for generating and resolving **External Identifiers** (3GPP External IDs) that uniquely associate an AF (Application Function) with a User Equipment (UE).
This type of information is typically stored or generated by the UDM. However, since most current open-source implementations of the core network do not support this feature, we provide it as part of our stack.

## Overview

This service enables:

- **Generating an External ID** using the AF ID and UE IP address
- **Resolving an External ID** back to the corresponding SUPI for internal NEF processing

## Endpoints

### 1. Generate External ID

- **Endpoint:** `/lookup?afId={afId}&ip={ueIp}`
- **Method:** `GET`
- **Description:** Resolves the UE IP to a SUPI using Redis, then generates a salted External ID using the AF ID
- **Response:**

```json
{
  "externalId": "{afId}:c0ffeee3322x5eyhtx"
}
```
### 2. Resolve External ID

- **Endpoint:** `/resolve?externalId={externalId}`
- **Method:** `GET`
- **Description:** Decodes the external ID and retrieves the original SUPI
- **Response:**

```json
{
  "supi": "00106000000001"
}
```

## Logic

- **/lookup**:
  - Looks up the UE IP in Redis to retrieve the SUPI
  - Concatenates the SUPI and AF ID
  - Hashes the concatenated value using a secure SALT
  - Returns the resulting External ID

- **/resolve**:
  - Decodes the External ID using the same SALT
  - Extracts and returns the SUPI

> It is the responsibility of the calling function to verify that the AF ID used during `/lookup` matches the AF ID that appears in the context of `/resolve`.

## Dependencies

- **Redis**: Used to resolve IP addresses to SUPIs

## Configuration

| Variable        | Description                | Default         |
|----------------|----------------------------|-----------------|
| `REDIS_SVC`   | Redis service url            | `redis:6379`     |
| `NBI_PORT`   | Northbound server port              | `8080`          |
| `HTTPS`| Use https for northbound server | `false` |
| `HTTP_VER` | Switch between HTTP1.1 and HTTP2         | `1`          |
| `SALT_KEY`     | Secret key for hashing     | `random_secret`      |

## Running Locally

```bash
cd ue-identity-service
export SALT_KEY="your-secure-salt"
go run main.go
```

## License

GPLv3